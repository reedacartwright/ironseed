---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# Ironseed

<!-- badges: start -->
[![R-CMD-check](https://github.com/reedacartwright/ironseed/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/reedacartwright/ironseed/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/reedacartwright/ironseed/graph/badge.svg)](https://app.codecov.io/gh/reedacartwright/ironseed)
<!-- badges: end -->

## Overview

Ironseed is an R package that improves seeding for R's built in random number
generators. An ironseed is a finite-entropy (or fixed-entropy) hash that can be
used to generate an unlimited sequence of seeds for initializing the state of a
random number generator. It is inspired by the work of M.E. O'Neill and others
[[1](https://www.pcg-random.org/posts/simple-portable-cpp-seed-entropy.html),
[2](https://gist.github.com/imneme/540829265469e673d045)].

An ironseed is a 256-bit hash constructed from a variable-length sequence of
32-bit inputs. Each ironseed consists of eight 32-bit sub-hashes. The sub-hashes
are 32-bit multilinear hashes [[3](https://arxiv.org/pdf/1202.4961.pdf)]
that accumulate entropy from the input sequence. Each input is included in every
sub-hash. The coefficients for the multilinear hashes are generated by a [Weyl
sequence](https://en.wikipedia.org/wiki/Weyl_sequence).

Multilinear hashes are also used to generate a seed sequence from an ironseed.
Each 32-bit output value is generated by uniquely hashing the sub-hashes. The
coefficients for the output are also generated by a second Weyl sequence.

## Installation

You can install the development version of ironseed from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("reedacartwright/ironseed")
```

## Examples: User Seeding

Ironseed can be used at the top of a script to robustly initialize R's builtin
random number generator. The resulting ironseed is returned invisibly, and a
message is generated notifying the user that initialization has occurred. This
message can be logged and later used to reproduce the run.

```{r}
#!/usr/bin/env -S Rscript --vanilla
ironseed::ironseed("Experiment", 20251031, 1)
runif(10)
```

```{r, include = FALSE}
ironseed:::rm_random_seed()
```

If your script is intended to be called multiple times as part of a large study,
you can also seed based on the command line arguments.

```{r}
#!/usr/bin/env -S Rscript --vanilla
args <- commandArgs(trailingOnly = TRUE)
ironseed::ironseed("A Simulation Script 1", args)
runif(10)
```

```{r, include = FALSE}
ironseed:::rm_random_seed()
```

Specific command line arguments can also be used. For large, nested studies, it
is useful for scripts to support seeding using multiple seeds. Ironseed makes
this easy to accomplish.

```{r}
#!/usr/bin/env -S Rscript --vanilla
args <- commandArgs(trailingOnly = TRUE)
ironseed::ironseed("A Simulation Script 2", args[grepl("--seed=", args)])
runif(10)
```

```{r, include = FALSE}
ironseed:::rm_random_seed()
```

## Examples: Automatic Seeding

Ironseed can also automatically initialize the random number generator using an
ironseed constructed from multiple sources of entropy. This occurs if no data
is passed to `ironseed()`.

```{r}
#!/usr/bin/env -S Rscript --vanilla
ironseed::ironseed()
runif(10)

# Since RNG initializing has occurred, the next call will simply
# return the ironseed used in previous seeding.
fe <- ironseed::ironseed()
fe
```

```{r, include = FALSE}
ironseed:::rm_random_seed()
```

Or achieving the same thing with one call. Note that the automatically generated
seed is different from the previous run.

```{r}
#!/usr/bin/env -S Rscript --vanilla
fe <- ironseed::ironseed()
runif(10)
fe
```

```{r, include = FALSE}
ironseed:::rm_random_seed()
```

## Examples: Reproducible Code

An ironseed can also be used directly to reproduce a previous initialization.
This is most useful when automatic seeding has been used, and the previously
generated seed has been logged.

```{r}
#!/usr/bin/env -S Rscript --vanilla
ironseed::ironseed("RW7vjwjeiHF-QG7RYPvrntR-6tGPoi65sVc-N1n5SQi5RH4")
runif(10)
```

```{r, include = FALSE}
ironseed:::rm_random_seed()
```
